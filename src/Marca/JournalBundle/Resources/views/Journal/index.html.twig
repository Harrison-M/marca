{# Marca/JournalBundle/Resources/views/Journal/index.html.twig #}

{% extends 'MarcaJournalBundle::layout.html.twig' %}

{% block content %}
<script language="javascript">
$(document).ready(function() { 
$('#journal_new').click(function(){
  $('#journal_modal').load('{{ course_path('journal_new_modal')  }}');
  $('#journal_modal').modal({
  backdrop: false
  });
});  
{% for journal in journal %}  
$('#response{{journal.id}}').click(function(){
  $('#journal_modal').load('{{ course_path('response_new_modal', { 'sourceid': journal.id, 'source': 'journal','view': 'app' }) }}');
  $('#journal_modal').modal({
  backdrop: false
  });
});  
{% endfor %}
    
});
</script>
{% if app.request.attributes.get('_route')=='journal_user' %}
<div class="span9"> 
<ul class="breadcrumb well">
<li> 
Journal entries by {{ user.firstname }} {{ user.lastname }} 
</li>

{# next previous users on roll #} 
<li class='pull-right'>
{% for roll in roll %}
{% if loop.index == app.request.get('user') + 1 %}  
<span style='margin-right:3em;'></span>        
<a data-index="{{loop.index}}" data-id='{{roll.userid}}' data-project='{{app.request.get('project')}}' data-tag='{{app.request.get('tag')}}' href="{{ course_path('journal_user', { 'userid': roll.userid, 'user': loop.index }) }}">{{roll.firstname}} {{roll.lastname}}<i class="icon-chevron-right"></i></a>
{% endif %}

{% if loop.index == app.request.get('user') - 1 %}
<a class='' data-index="{{loop.index}}" data-id='{{roll.userid}}' data-project='{{app.request.get('project')}}' data-tag='{{app.request.get('tag')}}' href="{{ course_path('journal_user', { 'userid': roll.userid, 'user': loop.index }) }}"><i class="icon-chevron-left"></i>{{roll.firstname}} {{roll.lastname}}</a>
{% endif %}
{% endfor %}
</li> 
</ul>
</div>
{% endif %}

<div class="span9 well">       
{% for journal in journal %}
<div id="journal{{journal.id}}" class="span7 center">
<div class="page-header" >
<strong><span class="journal-title">{{ journal.title }}</span></strong>
<span class="pull-right">
{% if journal.isOwner(app.user.username) %}
        <a class="btn btn-primary btn-small" href="{{ course_path('journal_edit', { 'id': journal.id }) }}">Edit</a>
{% endif %} 
        <a id="response{{journal.id}}" class="btn btn-small" href="javascript:void(0);">Respond</a>
</span>         
<br />
<span>Created  {{ journal.created|date('M d Y, h:ia') }}  / Updated  {{ journal.updated|date('M d Y, h:ia') }}</span>
</div>
<div class="journal-body">
{{ journal.body|raw }}
</div>    
    <div class="span7 pull-right">
    {% for response in journal.responses %}
    {% if loop.first %}    
    <div class="page-header margin-left" >
    <strong>Responses</strong>
    </div>       
    {% endif %}      
            <div class="span6 well">
                <strong>By {{ response.user.firstname}} {{ response.user.lastname}}</strong>
               {{ response.body|raw }} 
                {% if response.isOwner(app.user.username) %}
                <a class="btn btn-primary btn-mini pull-right" href="{{ course_path('response_edit', { 'id': response.id,'sourceid': journal.id, 'source': 'journal','view': 'app' }) }}">Edit</a>
                {% endif %}
            </div>   
    {% endfor %}    
            
    </div>        
</div> 

   
{% else %}   
{% if app.request.get('_route') == 'journal_user' %}  
Sorry, no entries were found.
{% else %}    
You donâ€™t have any journals yet. Why not <a href="{{ course_path('journal_new') }}">write one</a>?
{% endif %}

{% endfor %}

<div class="span8" > 
<div class="navigation">
    {{ knp_pagination_render(journal) }}
</div>              
</div>

{# Modal #}
<div id="journal_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">     
</div>

</div>
{% endblock %}
