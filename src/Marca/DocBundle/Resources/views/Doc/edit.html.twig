{# Marca/DocBundle/Resources/views/Doc/edit.html.twig #}

{% extends 'MarcaDocBundle::layout.html.twig' %}

{% block javascripts %}
<script src="{{ asset('bundles/marcahome/js/ckeditor/ckeditor.js') }}"></script>
<script src="{{ asset('bundles/marcahome/js/ckeditor/adapters/jquery.js') }}"></script>
<script src="{{ asset('bundles/marcahome/js/ckeditor_local/ckeditor_styles.js') }}"></script>
<script src="{{ asset('bundles/marcahome/js/ckeditor_local/ckeditor_tools.js') }}"></script>
{% endblock %}

{% block content %}
<script language="javascript"> 
$(document).ready(function()
{
$('#marca_docbundle_doctype_body').ckeditor( function() {}, {extraPlugins:'autogrow', autoGrow_maxHeight : 700, skin: 'BootstrapCK-Skin',forcePasteAsPlainText : true, stylesSet:'marca_styles',contentsCss:'{{ asset('bundles/marcahome/css/ckeditor41.css') }}', 
toolbar : [
['Preview','-', 'Print','Templates','Undo','Redo','Find','Replace','SelectAll','RemoveFormat'],
['Bold','Italic','Underline','Strike','Subscript','Superscript','NumberedLst','BulletedList','Outdent','Indent','Blockquote'],
['JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock','Link','Unlink','Image','Table','HorizontalRule','Smiley','SpecialChar'],
['Styles','Format','Font','FontSize','TextColor','BGColor','Maximize', 'ShowBlocks','About']
],} );
$('#backup_alert').toggle();

var editor = $('#marca_docbundle_doctype_body').ckeditorGet();

var intervalID = setInterval(function(){var buffer = editor.checkDirty(); if (buffer==1) {editor.resetDirty(); $.post("{{ course_path('doc_ajax', { 'id': doc.id }) }}", {test:$('#marca_docbundle_doctype_body').val()}, function(data){
    alert(data.test)});$('#backup_alert').fadeIn();$('#backup_alert').delay(2000).fadeOut();}}, 5000);
});
</script>

<ul class="nav nav-tabs">
    <li><h2 class="">{{file.name}}</h2></li>    
    <li class="nav-header">Last updated on {{doc.updated|date('M d Y,   g:i a')}}</li>
</ul>

<form id="doc_form" action="{{ course_path('doc_update', { 'id': doc.id }) }}" method="post" {{ form_enctype(edit_form) }}>
<div class="span9">         

    {{ form_errors(edit_form) }}
    {{ form_errors(edit_form.body) }}
    {{ form_widget(edit_form.body) }}
    {{ form_rest(edit_form) }}    

</div>

<div class="span2 well doc" style="">
<div class="cell clear divider">
    <p style='min-height:1.5em;'><span id='backup_alert' class='alert alert-success'>Backing up work</span></p>
    <input class="btn btn-primary btn-small" type="submit" id="doc_save" value="Save"/>
    <a class="btn btn-small" href="{{ course_path('doc_show', { 'id': doc.id }) }}">Cancel</a>
</div>    
{%include 'MarcaDocBundle:Doc:doctools.html.twig' %}
</div>         
</div> 
        
</form>      

{% endblock %}
