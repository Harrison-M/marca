{# Marca/DocBundle/Resources/views/Doc/edit.html.twig #}

{% extends 'MarcaDocBundle::layout.html.twig' %}

{% block javascripts %}
<script src="{{ asset('bundles/marcahome/js/ckeditor/ckeditor.js') }}"></script>
<script src="{{ asset('bundles/marcahome/js/ckeditor_local/ckeditor_styles.js') }}"></script>
<script src="{{ asset('bundles/marcahome/js/ckeditor_local/ckeditor_tools.js') }}"></script>
{% endblock %}

{% block content %}
<script language="javascript"> 
$(document).ready(function()
{   
var winheight = $(document).height() * .70;

CKEDITOR.replace( 'marca_docbundle_doctype_body',  {
    height: winheight,
    stylesSet: 'marca_styles',
    toolbar : [
    ['Styles','Bold','Italic','Underline','Strike','Font','FontSize'],['JustifyLeft','JustifyCenter','JustifyRight'],['TextColor','BGColor'],['Link','Unlink'],
    ['NumberedList','BulletedList'],['Outdent','Indent'],['Image','MediaEmbed'],['Undo','Redo'],['RemoveFormat']
    ],
    contentsCss:'{{ asset('bundles/marcahome/css/ckeditor41.css') }}',
    customConfig: '{{ asset('bundles/marcahome/js/ckeditor_local/ckeditor_config.js') }}'
} );

$('#backup_alert').toggle();

$('#doctools').css('height', function(index) {
  return $(window).height() * .77;
});

var editor = $('#marca_docbundle_doctype_body').ckeditorGet();

var intervalID = setInterval(function(){var buffer = editor.checkDirty(); if (buffer==1) {editor.resetDirty(); $.post("{{ course_path('doc_ajax', { 'id': doc.id }) }}", {test:$('#marca_docbundle_doctype_body').val()}, function(data){
    alert(data.test)});$('#backup_alert').fadeIn();$('#backup_alert').delay(2000).fadeOut();}}, 5000);
});
</script>

<div class="span12 center" style='margin-top:-.78em;'>
<form id="doc_form" class="" action="{{ course_path('doc_update', { 'id': doc.id,'view': app.request.get('view') }) }}" method="post" {{ form_enctype(edit_form) }}>

<div class="span12 center" style="margin-top:1em;width:92%">
    <h3  class='inline' style="margin-left:-4%;">{{file.name}}</h3>     
    <span class="pull-right" style="margin-top:8px;margin-right:2.7%;">
    <span id='backup_alert' class='alert alert-info margin-left' style="padding:8px;margin-right:12px;">Backing up work</span> 
    <div class="btn-group">
    <input class="btn btn-primary btn-small margin-left" type="submit" id="doc_save" value="Save"/>
    <a class="btn btn-small" href="{{ course_path('doc_show', { 'id': doc.id, 'view': app.request.get('view') }) }}">Cancel</a>
    </div>
    </span>
</div>

<div id='doc-gui' class="span8 margin-top" style="margin-bottom:1em;margin-left:0;">         

    {{ form_errors(edit_form) }}
    {{ form_errors(edit_form.body) }}
    {{ form_widget(edit_form.body) }}
    {{ form_rest(edit_form) }}    

</div>
     
              
{# Doc tools #}        
<div class="span3" >         
<div id='doctools' class="span3 well">  
<div  class='cell clear'>

{%include 'MarcaDocBundle:Doc:doctools.html.twig' %}

</div> 
</div>
</div>
    
        
</form>      
</div>
{% endblock %}
